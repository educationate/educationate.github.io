const B=e;(function(h,i){const y=e,j=h();while(!![]){try{const k=-parseInt(y(0x20f))/0x1+parseInt(y(0x215))/0x2*(-parseInt(y(0x211))/0x3)+-parseInt(y(0x1db))/0x4*(parseInt(y(0x208))/0x5)+-parseInt(y(0x23a))/0x6*(-parseInt(y(0x1df))/0x7)+-parseInt(y(0x1e7))/0x8+parseInt(y(0x210))/0x9*(-parseInt(y(0x1e9))/0xa)+-parseInt(y(0x1f9))/0xb*(-parseInt(y(0x22c))/0xc);if(k===i)break;else j['push'](j['shift']());}catch(n){j['push'](j['shift']());}}}(d,0xca80a));function d(){const a1=['image/png','txt','readwrite','gm\x20loader\x20db','YcmYJ','installing','string','waiting','image/gif','application/octet-stream','text/plain','application/pdf','1396990PGnKZv','open','split','updateLastPlayed','uploadDate','json','application/zip','1390920hoZwBX','7123626osgZna','228036UbJwTB','ready','getAll','ghMGf','32mmVvMm','toString','result','gms','warn','bYHid','continue','extractMultipleZips','/index.html','onerror','log','console','delete','value','extractZip','active','serviceWorker','cleanupOld','initDB','files','font/ttf','audio/mpeg','controllerchange','12zrKJPq','async','onupgradeneeded','mFlCt','put','image/jpeg','image/x-icon','text/markdown','onsuccess','apply','transaction','application/json','pop','image/avif','42Losnza','openCursor','readonly','mjs','getRegistrations','target','FhByp','return\x20(function()\x20','none','SGSMa','font/woff','css','{}.constructor(\x22return\x20this\x22)(\x20)','from\x20local\x20gm\x20loader','isArray','audio/aac','exception','load','application/wasm','error','application/vnd.ms-fontobject','20PcMEEi','getMime','raTJm','htm','1027691vPVVdZ','mYlVq','NlFOY','getGm','__proto__','controller','activated','addEventListener','5458512sarDEq','text/css','10QZLwHw','video/webm','length','bind','dbAction','audio/ogg','svg','video/ogg','toISOString','saveGm','scriptURL','BgAUv','now','base64','has','isBinary','58076579BJLjTM','application/javascript','uycnS'];d=function(){return a1;};return d();}const b=(function(){let h=!![];return function(i,j){const k=h?function(){const z=e;if(j){const n=j[z(0x235)](i,arguments);return j=null,n;}}:function(){};return h=![],k;};}()),a=b(this,function(){const A=e,h={'FhByp':function(n,o){return n+o;},'mYlVq':'info','tmiqD':function(n,o){return n<o;}};let i;try{const n=Function(h[A(0x1cc)](A(0x1cd)+A(0x1d2),');'));i=n();}catch(o){i=window;}const j=i[A(0x220)]=i[A(0x220)]||{},k=[A(0x21f),A(0x219),h[A(0x1e0)],'error',A(0x1d6),'table','trace'];for(let q=0x0;h['tmiqD'](q,k[A(0x1eb)]);q++){const r=b['constructor']['prototype'][A(0x1ec)](b),s=k[q],t=j[s]||r;r[A(0x1e3)]=b['bind'](b),r['toString']=t[A(0x216)]['bind'](t),j[s]=r;}});function e(a,b){a=a-0x1c8;const c=d();let f=c[a];return f;}a();import{ag as f}from'./vendor-modules.DGe1DaoG.js';const p=B(0x1ff),g=0x1,c=B(0x218),m=new Set(['html',B(0x1de),B(0x1d1),'js',B(0x1c9),B(0x20d),'xml',B(0x1fd),'md','csv',B(0x1ef)]);class w{constructor(){this['db']=null;}async[B(0x227)](){return this['db']?this['db']:new Promise((h,j)=>{const C=e,k=indexedDB[C(0x209)](p,g);k[C(0x21e)]=()=>j(k['error']),k['onsuccess']=()=>{const D=C;this['db']=k[D(0x217)],h(this['db']);},k[C(0x22e)]=n=>{const E=C,o=n['target'][E(0x217)];o['objectStoreNames']['contains'](c)||o['createObjectStore'](c,{'keyPath':'id'});};});}async[B(0x1ed)](h,j){const F=B,k={'hGzHD':function(o,q,r,s){return o(q,r,s);}},n=await this[F(0x227)]();return new Promise((q,r)=>{const G=F,u=n[G(0x236)]([c],h)['objectStore'](c);k['hGzHD'](j,u,q,r);});}async['saveGm'](h,j){const H=B;return this[H(0x1ed)]('readwrite',(k,n,o)=>{const I=H,q=k['put']({'id':h,'name':h,'files':j,'uploadDate':new Date()[I(0x1f1)](),'lastPlayed':new Date()['toISOString']()});q[I(0x234)]=()=>n(),q[I(0x21e)]=()=>o(q[I(0x1d9)]);});}async[B(0x20b)](h){const J=B;return this[J(0x1ed)](J(0x1fe),(j,k,n)=>{const K=J,o=j['get'](h);o[K(0x234)]=()=>{const L=K,q=o[L(0x217)];if(q){q['lastPlayed']=new Date()[L(0x1f1)]();const u=j[L(0x230)](q);u[L(0x234)]=()=>k(),u['onerror']=()=>n(u['error']);}else k();},o['onerror']=()=>n(o['error']);});}async[B(0x226)](){const h={'uycnS':function(i,j){return i<j;},'THyEB':function(i){return i();}};return this['dbAction']('readwrite',(j,k,n)=>{const M=e,o=j[M(0x23b)](),q=Date[M(0x1f5)]()-0x10e0*0x3c*0x3e8;o[M(0x234)]=u=>{const N=M,v=u[N(0x1cb)]['result'];if(v){const x=v[N(0x222)];h[N(0x1fb)](new Date(x['lastPlayed']||x[N(0x20c)])['getTime'](),q)&&v[N(0x221)](),v[N(0x21b)]();}else h['THyEB'](k);},o[M(0x21e)]=()=>n(o[M(0x1d9)]);});}async[B(0x1e2)](h){const O=B;return this[O(0x1ed)](O(0x1c8),(j,k,n)=>{const o=j['get'](h);o['onsuccess']=()=>k(o['result']),o['onerror']=()=>n(o['error']);});}async['getAllGms'](){const P=B;return this[P(0x1ed)]('readonly',(h,j,k)=>{const Q=P,n=h[Q(0x213)]();n['onsuccess']=()=>j(n[Q(0x217)]||[]),n['onerror']=()=>k(n[Q(0x1d9)]);});}['isBinary'](h){const R=B,j=h['split']('.')[R(0x238)]()['toLowerCase']();return!m[R(0x1f7)](j);}async[B(0x223)](h){const S=B,j={'eYJSd':S(0x1f6)},k=await(await fetch(h))['blob'](),q=await new f()['loadAsync'](k),t={};for(const [u,v]of Object['entries'](q[S(0x228)]))if(!v['dir']){const x=this[S(0x1f8)](u);t[u]={'content':await v[S(0x22d)](x?j['eYJSd']:S(0x202)),'mime':this[S(0x1dc)](u),'binary':x};}return t;}async[B(0x21c)](h){const T=B,j={};for(const k of h){const n=await this[T(0x223)](k);Object['assign'](j,n);}return j;}[B(0x1dc)](h){const U=B,j={'raTJm':'text/html','NlFOY':U(0x1e8),'yuXfR':'application/xml','BLHxK':'text/csv','ddlPh':'image/jpeg','BgAUv':'image/svg+xml','ghMGf':'image/bmp','QLJsl':U(0x1d5),'jUFDv':U(0x1f0),'Jduqs':U(0x1d8),'bYHid':U(0x20e),'SGSMa':'application/gzip','mFlCt':U(0x205)},k=h[U(0x20a)]('.')['pop']()['toLowerCase']();return{'html':j[U(0x1dd)],'htm':j[U(0x1dd)],'css':j[U(0x1e1)],'js':U(0x1fa),'mjs':U(0x1fa),'json':U(0x237),'xml':j['yuXfR'],'txt':U(0x206),'md':U(0x233),'csv':j['BLHxK'],'png':U(0x1fc),'jpg':U(0x231),'jpeg':j['ddlPh'],'gif':U(0x204),'svg':j[U(0x1f4)],'ico':U(0x232),'webp':'image/webp','bmp':j[U(0x214)],'avif':U(0x239),'woff':U(0x1d0),'woff2':'font/woff2','ttf':U(0x229),'otf':'font/otf','eot':U(0x1da),'mp3':U(0x22a),'wav':'audio/wav','ogg':U(0x1ee),'m4a':'audio/mp4','aac':j['QLJsl'],'mp4':'video/mp4','webm':U(0x1ea),'ogv':j['jUFDv'],'wasm':j['Jduqs'],'zip':j[U(0x21a)],'gz':j[U(0x1cf)],'pdf':U(0x207),'data':'application/octet-stream','unityweb':'application/octet-stream','bundle':j['mFlCt'],'bin':'application/octet-stream','dat':j[U(0x22f)],'mem':'application/octet-stream','asset':U(0x205),'resource':j['mFlCt']}[k]||U(0x205);}async['regSW'](){const V=B,h={'TdyMr':V(0x22b),'YcmYJ':function(j,k){return j in k;}};if(h[V(0x200)]('serviceWorker',navigator))try{let j=(await navigator['serviceWorker'][V(0x1ca)]())['find'](k=>k[V(0x224)]?.[V(0x1f3)]['includes']('/loadersw.js'));if(!j){const k=await navigator[V(0x225)]['register']('/loadersw.js',{'scope':'/','updateViaCache':V(0x1ce)});return await navigator['serviceWorker']['ready'],navigator[V(0x225)][V(0x1e4)]||await new Promise(n=>{const W=V;navigator[W(0x225)]['addEventListener'](W(0x22b),n,{'once':!0x0});}),k;}if((j[V(0x201)]||j[V(0x203)])&&await new Promise(n=>{const X=V,o=j[X(0x201)]||j[X(0x203)];o[X(0x1e6)]('statechange',()=>{const Y=X;o['state']===Y(0x1e5)&&n();});}),!navigator[V(0x225)][V(0x1e4)]){const n=(await navigator[V(0x225)][V(0x212)])['active'];n&&(n['postMessage']({'type':'SKIP_WAITING'}),await new Promise(o=>{const Z=V;navigator[Z(0x225)][Z(0x1e6)](h['TdyMr'],o,{'once':!0x0});}));}return j;}catch(o){console['error'](V(0x1d3),o);}}async[B(0x1d7)](h,j){const a0=B,k={'GhFTn':function(u,v){return u(v);}};await this['regSW'](),await this['initDB']();const n=Array[a0(0x1d4)](h),q=(n?h[0x0]:h)[a0(0x20a)]('/')['pop']()['replace']('.zip','')||'gm-'+Date['now']();if(await this['getGm'](q))return await this['updateLastPlayed'](q),{'url':'/game/'+q+a0(0x21d),'cached':!0x0};j&&k['GhFTn'](j,!0x0);const r=n?await this[a0(0x21c)](h):await this['extractZip'](h);return await this[a0(0x1f2)](q,r),j&&j(!0x1),{'url':'/game/'+q+a0(0x21d),'cached':!0x1};}}export{w as default};